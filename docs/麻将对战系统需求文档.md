# 麻将对战系统需求文档

## 1. 项目概述

开发一个基于内存的麻将对战系统，允许用户创建房间、加入房间并进行麻将游戏。系统不内置完整的麻将规则，但提供基本的牌操作功能，由玩家自行判断胜负。

## 2. 技术栈

- 后端：Spring Boot
- 前端：React + JavaScript + zustand
- 通信：主要使用WebSocket，部分功能使用HTTP
- 认证：JWT (JSON Web Token)，存储在localStorage
- 数据存储：内存存储，无数据库
- 前端UI库：选择适合的UI库实现

## 3. 用户认证与管理

- 用户通过邮箱进行身份识别，邮箱ID作为唯一标识
- 使用JWT进行认证，Token存储在前端localStorage
- 用户可以随时修改自己在房间内的昵称
- 如未设置昵称，默认使用邮箱@符号前的文字作为昵称

## 4. 房间管理

### 4.1 房间创建
- 用户可以创建新房间
- 系统自动生成1-999之间的房间号和4位数字的密码
- 房间创建者成为房间主人

### 4.2 房间生命周期
- 房间有效期为24小时
- 12小时后房间将被系统自动删除（定时任务）
- 即使房间正在进行对局，到期也会终止游戏并通知前端

### 4.3 房间加入
- 用户可以查看并选择加入现有房间
- 每个房间最多容纳4名玩家
- 最少需要2名玩家才能开始游戏
- 玩家一旦确认加入房间后不能被替换
- 非房间玩家不能进入观战

### 4.4 房间显示
- 显示每个玩家的邮箱和昵称
- 显示房间号和密码
- 显示房间剩余有效时间

## 5. 游戏流程

### 5.1 游戏开始
- 当房间内有2名或以上玩家时，房间创始人可以宣布开局
- 首次对局时，房间创始人为庄家，获得14张牌
- 其他玩家各获得13张牌
- 后续对局中，上一局获胜者为庄家

### 5.2 游戏界面
- 界面分为上、下、左、右、中五个区域
- 玩家按进入房间顺序分配为1号、2号、3号、4号
- 每个玩家在自己的视角中位于下方位置
- 其他玩家按顺时针顺序排列
- 显示牌库剩余的牌数
- 玩家可以拖动手牌来给自己的牌排序

### 5.3 游戏操作
- 玩家可以随时执行以下操作（非回合制）：
  - 打出一张牌
  - 从牌库中抽取一张或多张牌
  - 中间区域显示已经被打出的牌，按照顺序
  - 从桌面上拿取别人出的一张或多张牌，放到自己的牌中
  - 明牌一张或多张牌, 其他人就可以看到
  - 宣布自己是胜利者
  - 每个人操作后，屏幕上方会显示谁干了什么操作，只显示倒数俩个操作。
  

### 5.4 胜负判定
- 当玩家宣布自己胜利时，系统提示所有其他玩家进行确认
- 只有所有玩家都确认后，该玩家才被判定为胜利
- 如有任何玩家拒绝确认，游戏继续
- 当牌库中没有牌时，游戏判定为平局

### 5.5 游戏结束
- 游戏结束后，所有玩家的牌将被明示
- 房间进入新的对局准备状态，等待房间创始人宣布开局
- 获胜玩家成为下一局的庄家

### 5.6 断线重连
- 玩家可以随时离线和重新连接
- 系统不需要确认玩家是否在线
- 重连后玩家可以继续参与当前游戏

## 6. 麻将牌组

中国麻将牌组共136张牌，分为以下几类：
1. **万子牌**：从一万到九万，每种牌有4张，共36张
2. **筒子牌**：从一筒到九筒，每种牌有4张，共36张
3. **条子牌**：从一条到九条，每种牌有4张，共36张
4. **字牌**：
   - **风牌**：东、南、西、北，每种牌有4张，共16张
   - **箭牌**：中、发、白，每种牌有4张，共12张

## 7. 技术要求

### 7.1 前端
- 使用React开发
- 前后端分离架构
- API地址不硬编码
- 使用WebSocket进行实时通信
- JWT认证，Token存储在localStorage

### 7.2 后端
- 使用Spring Boot开发
- 提供WebSocket和HTTP API
- 实现JWT认证
- 内存数据存储
- 实现房间自动清理的定时任务

## 8. 系统限制

- 无数据库，所有数据存储在内存中
- 不内置麻将规则和胜利条件
- 房间有效期为24小时 